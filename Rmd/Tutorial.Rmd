---
title: 'So Many Species, So Little Time: Measuring Biodiversity'
author: "Margaret Slein, Jory Griffiths, Egor Katkov (Living Data Project)"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = F, warning=F, message=F, echo=F)
```



Ecologists are often interested in the effects of perturbations (e.g. fires, logging, flooding or pollution) on biodiversity. 
However, boiling biodiversity down to a single metric can be difficult.
With the help of the Turkey lake dataset of benthic invertebrates [@reference], we will present you with a number of common metrics, their meaning, and how they can be visualized with the help of a Rank-Abundance curves. 
You will then have the option to learn to do it yourself using an R package called codyn.

# The Data

The Turkey Lakes Watershed Study (see map) is an initiative by several agencies of the government of Canada, initially designed to study the effects of acid rain on forest ecosystems.
From 1995 to 2009, scientists collected, identified and counted benthic invertebrates from various stream beds around the Turkey Lakes catchment. 
Benthic invertebrates are small, often microscopic organisms (see Fig. 1), but form an important link between aquatic and terrestrial habitats . 
They can decompose terrestrial matter such as leaves, or consume periphyton growing on rocks within their streams.
Benthic invertebrates can be a food source for aquatic animals, like small fish, or terrestrial animals such as fish.
An experiment was conducted in 1997, where certain sampling sites experienced different levels of logging intensity.
Due to their interaction with the terrestrial realm, we can hypothesize that the biodiversity of benthic invertebrate communities might be affected by logging.

![Fig. 1: Various benthic macroinvertebrates under a stereo microscope. Source: G. Carter via NOAA/GLERL](benthicmacroinvertebrates_g.carter_noaa600px.jpg)



```{r include=T}
library(leaflet)

leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=-84.4110, lat=47.0515, popup="Turkey Lakes")

```

# Why biodiversity matters 

In an ever-changing world, as biologists, we are often concerned with how organisms will be able to cope with disturbances and increasingly, global climate change. We often think of biodiversity as an important buffer to withstanding these changes, as more diversity may mean more success in environments persisting beyond the change. It is the idea of survival of the fittest, but with more security in sheer numbers. 


# Types of data typically collected

Often times, biologists interested in collecting biodiversity data collect a standard set of responses. These often include:

1. The different kinds of species in a given area or environment 
2. The number of each of these species (abundance)
3. Information about the area itself (i.e. habitat type, weather conditions, etc.)
4. If the work involves an setting up an experiment, collecting the control vs. experimental groups as well as metrics for repeatability + statistical power (replicates)
5. Of course, the time frame over which the data were collected

# Different way to analyse this data :

## Quantifying Species Richness
                                 
Perhaps the simplest measure of biodiversity is species richness ($S_r$). 

We calculate species richness by simply counting the number of species in an area with an abundance greater than $0$.

$$
S_r = sum(\mathrm{abundance})
$$


```{r exercise=T, include=T, echo=T}
library(tidyverse)
# Code or exercise on calculating species richness?
#before 
set.seed(2)
data_2007 <- data.frame(
  species = sample(1:20, 40, replace=2), 
  abundance = sample(0:200, 40, replace=2), 
  time= 2007, 
  treatment=sample(c("control", "experiment"), 40, replace=2)
)

data_2018 <- data.frame(
  species = sample(1:20, 40, replace=2), 
  abundance = sample(0:200, 40, replace=2), 
  time= 2018, 
  treatment=sample(c("control", "experiment"), 40, replace=2)
) 

fake_data <- rbind(data_2007, data_2018) 

#number of species 
#species evenness

```




## Shannon Index



## Evenness Index



## Community Stability


# Ways we can convey all of this information in graphs 


## Rank Abundance Curve

One way to visualize biodiversity data is to make a Rank Abundance Curve. On the y-axis we have the abundance of each species, and species, ranked by abundance on the x-axis.












